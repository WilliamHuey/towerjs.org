<h1>Contributing to Tower</h1>

<h3>Windows:</h3>

<p>Windows is now supported.</p>

<p>This guide is for developing Tower in a Mac OS X environment. (Windows follows the same installation. Just make sure you have <code>make</code> installed as it doesn't come natively.)</p>

<p>All contributions, either via master or the wiki, get credit in <a href="http://towerjs.org/contributors">Tower Contributors</a> once we get that page up.</p>

<p>Also, we will create gists named <code>Tower.js Discussion - [topic goes here]</code> until GitHub has a Google Groups replacement.  I'm too much a fan of syntax highlighting to use Google Groups :)</p>

<h1>Contributing to the Tower Codebase</h1>

<p>Tower's <code>master</code> branch is always a reflection of what you'll get with <code>npm install</code>.  Tower's <code>development</code> branch is the latest stuff.  So when a pull request is merged, it's first going to be merged to development and it may be a while before it's pushed to master.  Issues will be closed when code is pushed to master.</p>

<p>First setup your Tower development [[environment]].</p>

<p><a name="create-a-dedicated-branch" href="#create-a-dedicated-branch"></a></p>

<h2>Create a dedicated branch</h2>

<div class="highlight"><pre lang="">git branch development
git checkout development
</pre></div>

<p>It doesn't really matter what name you use, because this branch will only exist on your local computer and your personal repository on GitHub. It won't be part of the Tower git repository.</p>

<p>This is also optional, but it's good practice. You can also use feature branches on your main development branch.</p>

<p><a name="compile-the-coffee-script-files-for-tower" href="#compile-the-coffee-script-files-for-tower"></a></p>

<h1>Setting up your environment</h1>

<p>For starters you'll need <code>npm</code>, <code>node</code>, and <code>git</code> of course. </p>

<ul>
<li>The first thing you'll want to do is fork your own copy of Tower into your own git repository. After you've forked Tower you'll need to clone it locally.</li>
</ul>

<div class="highlight"><pre lang="">git clone git://github.com/username/repository.git some_folder_here && cd some_folder_here
</pre></div>

<ul>
<li>After downloading a fresh copy of Tower you'll need to install all of the dependencies.</li>
</ul>

<div class="highlight"><pre lang="">make install
</pre></div>

<ul>
<li>Your now ready to begin stabbing at Tower's source code, but first you need to start the <code>watch</code> command to automatically compile the coffeescript when you've added, edited, or deleted a file. </li>
</ul>

<div class="highlight"><pre lang="">make watch
</pre></div>

<p>This process will need to remain open when tampering with Tower's source.</p>

<ul>
<li>If you want to use your version of Tower inside one of your apps to test stuff you'll need to run: (Make sure you're within the tower directory you created earlier) </li>
</ul>

<div class="highlight"><pre lang="">npm link
</pre></div>

<ul>
<li>To use your local version of Tower <code>cd</code> into one of your apps and run:</li>
</ul>

<div class="highlight"><pre lang="">npm link tower
</pre></div>

<p>This will link your version of Tower with your app so that you can test stuff out. </p>

<h2>Compile the CoffeeScript Files for Tower</h2>

<p><strong>Note:</strong> Tower does not use Design.io anymore. It uses a mixture of gruntjs and cake files. </p>

<div class="highlight"><pre lang="">cake watch # App Development
make watch # Tower's Source Development
</pre></div>

<p><a name="write-your-code" href="#write-your-code"></a></p>

<h2>Write Your Code</h2>

<p>The code should be written Test Driven. Use mocha to execute the Tower test suite.<br />To run the entire test suite from the console, simply execute:</p>

<div class="highlight"><pre lang="">npm test
</pre></div>

<p>That references the <code>test</code> key in <a href="https://github.com/viatropos/tower/blob/e0e3348a1d36c35b8b088434185fb3b3529cc698/package.json#L82">package.json</a>, which looks like this:</p>

<div class="highlight"><pre lang="">mocha $(find test -name "*Test.coffee")
</pre></div>

<p>You can customize this expression to run a subset of tests if you're developing something and don't want the clutter.</p>

<p>Example: run all "article" related tests</p>

<p><code>mocha $(find test -name "article*Test.coffee")</code></p>

<p>See [[Browser testing]] for more info.</p>

<p><a name="follow-the-coding-conventions" href="#follow-the-coding-conventions"></a></p>

<h2>Follow the Coding Conventions</h2>

<p>Tower follows a simple set of coding style conventions.</p>

<ul>
<li>Two spaces, no tabs.</li>
<li>No trailing whitespace. Blank lines should not have any space.</li>
<li>Prefer &amp;&amp;/|| over and/or.</li>
<li><code>a = b</code> and not <code>a=b</code>.</li>
<li>Follow the conventions you see used in the source already.  Check the <a href="https://github.com/viatropos/tower/wiki/style">style guide</a> for a few notes as well.</li>
</ul>

<p><a name="commit-your-changes" href="#commit-your-changes"></a></p>

<h2>Commit Your Changes</h2>

<p>When you're happy with the code on your computer, you need to commit the changes to git:</p>

<div class="highlight"><pre lang="">git commit -a -m "Here is a commit message on what I changed in this commit"
</pre></div>

<p>Please <a href="http://ariejan.net/2011/07/05/git-squash-your-latests-commits-into-one">squash your commits into a single commit</a> when appropriate. This simplifies future cherry picks, and also keeps the git log clean.</p>

<p>Before you do the final push, synchronize with upstream from @viatropos/master</p>

<div class="highlight"><pre lang="">git remote add upstream <a href='mailto:git@github.com'>git@github.com</a>:viatropos/tower.git
git fetch upstream
git merge upstream/master
</pre></div>

<p><a name="issue-a-pull-request" href="#issue-a-pull-request"></a></p>

<h2>Issue a Pull Request</h2>

<p>Push your code to your repository</p>

<p><code>git push</code></p>

<p>and <a href="(http://help.github.com/send-pull-requests/">issue a pull request</a>:</p>

<p><a name="get-some-feedback" href="#get-some-feedback"></a></p>

<h2>Get Some Feedback</h2>

<p>Now you need to get other people to look at your patch, just as you've looked at other people's patches. You can use the <code>#towerjs</code> channel on IRC freenode for this. You might also try just talking to Tower developers that you know.</p>

<h1>Contributing to the Tower Documentation</h1>

<p>Tower has two main sets of documentation: The guides help you to learn Tower, and the actual code API for reference.</p>

<p>You can help improve the Tower guides by making them more coherent, adding missing information, correcting factual errors, fixing typos, bringing it up to date with the latest edge Tower.</p>

<p><a name="development-guide" href="#development-guide"></a></p>

<h2>Development guide</h2>

<p>Tower should also have a development guide that goes through the main structure of Tower, the APIs and how to add functionality while following the existing conventions and design/architecture.</p>

<p>The development guide should be structured according to the folder structure inside lib/tower:</p>

<ul>
<li>Application
<ul><li>Locale</li></ul></li>
<li>Client
<ul><li>Application</li>
<li>Controller</li>
<li>Store</li>
<li>View</li></ul></li>
<li>Controller</li>
<li>Http
<ul><li>Param</li>
<li>Route</li></ul></li>
<li>Middleware</li>
<li>Model
<ul><li>Locale</li>
<li>Relation</li>
<li>Scope</li>
<li>Validator</li></ul></li>
<li>Server
<ul><li>Application</li>
<li>Command</li>
<li>Controller</li>
<li>Generator</li>
<li>Mailer</li>
<li>Middleware</li>
<li>Store</li></ul></li>
<li>Store
<ul><li>Memory</li></ul></li>
<li>Support
<ul><li>Locale</li></ul></li>
<li>View
<ul><li>Form</li>
<li>Helpers</li>
<li>Locale</li></ul></li>
</ul>

<p><a name="minimal-amount-of-code" href="#minimal-amount-of-code"></a></p>

<h2>Minimal amount of code</h2>

<p>Every method should strive to be as simple as possible while still being able to handle as many cases as possible.  Refactor it into something reusable if possible.  Sacrifice performance only when you eliminate a lot of code (by "performance", I'm talking about differences like those between functions and for loops for iterating).</p>

<p><a name="the-most-efficient-implementations" href="#the-most-efficient-implementations"></a></p>

<h2>The most efficient implementations</h2>

<p>Every method should not only be minimal, it should also be efficient, using formal algorithms where possible.  But, if the algorithm implementation is significantly longer than a less efficient solution, or you'd have to import an external dependency, go with the less efficient solution, somehow get that external library to be part of something standard like underscore.js, or create a new algorithm.</p>

<p><a name="minimize-the-amount-of-methods-you-have-on-the-class" href="#minimize-the-amount-of-methods-you-have-on-the-class"></a></p>

<h2>Minimize the amount of methods you have on the class</h2>

<p>There is a tradeoff here.  If you're going to be using some set of functionality on a class all the time, then go with whatever's simpler for the developer.  However, if it's an edge/uncommon case, then wrap it in a nested object.</p>

<p>An example is with the finder API vs configuration variables.</p>

<p>Instead of doing this for configuration, which just adds a bunch of methods to the API:</p>

<div class="highlight"><pre lang=" coffeescript">class App.User extends Tower.Model
  @defaultScope @desc("createdAt")
  @collectionName "people"
</pre></div>

<p>Do this:</p>

<div class="highlight"><pre lang=" coffeescript">class App.User extends Tower.Model
  @configure
    scope:          @desc("createdAt")
    collectionName: "people"
</pre></div>

<p>This way we have 1 method, <code>configure</code>, instead of potentially dozens of methods.  This makes the class feel much lighter and easier to work with.</p>

<p>But when you use the methods all the time, you don't want to have to drill down through an object (law of demeter).  You can see this through the scoping api</p>

<p>Imagine writing this a 100 times:</p>

<div class="highlight"><pre lang=" coffeescript">User.criteria().where(firstName: "Lance")
</pre></div>

<p>instead of this:</p>

<div class="highlight"><pre lang=" coffeescript">User.where(firstName: "Lance")
</pre></div>

<p>In the first case, we have a simpler api, but it makes development more burdensome and less intuitive.  In the second case, it's very clear what's going on, even though we add several methods (<code>where</code>, <code>anyIn</code>, etc.) to the class API.</p>

<p>A tricky case is with methods for model naming: <code>toKey</code>, <code>toParam</code>, etc.  Those are not that commonly used, but it makes sense doing <code>model.toParam()</code> rather than something like <code>model.names().param</code>.  This is where you have to make the call.  I tend to go with putting it all in a nested object, and then adding methods if it turns out it would make life easier down the road.  Don't prematurely add methods unless it's just totally obvious you'll be using them.</p>

<p><a name="build-it-so-you-can-progressively-add-features" href="#build-it-so-you-can-progressively-add-features"></a></p>

<h2>Build it so you can Progressively Add Features</h2>

<p>Instead of making it so the <code>model.set</code> method can do <em>everything</em>, make it handle the simple case and make that module usable by itself.  This way, if you have a simple app, you can use the version/parts of the library that's a lot lighter than the complete solution.  But also make it so it doesn't require <em>too much</em> memory/processing to append these new features if you do want them (other than the fact you'll have to load more code).  I'm talking about not forcing every module to call <code>super</code> if it overrides a method in a simpler method.  Somehow organize your code so you can minimize these types of extra method calls while still making it enhanceable.</p>

<p><a name="minimize-the-number-of-singular-plural-method-implementations-purely-aesthetic" href="#minimize-the-number-of-singular-plural-method-implementations-purely-aesthetic"></a></p>

<h2>Minimize the number of singular/plural method implementations (purely aesthetic)</h2>

<p>You can use both if it makes testing your methods easier, but just make sure it's not purely aesthetic.</p>

<div class="highlight"><pre lang=" coffeescript">class App.User extends Tower.Model
  @default "store", Tower.Store.Memory
  @default "scope", @desc("createdAt")
</pre></div>

<div class="highlight"><pre lang=" coffeescript">class App.User extends Tower.Model
  @defaults store: Tower.Store.Memory, scope: @desc("createdAt")
</pre></div>

<h1>Helping to Resolve Existing Issues</h1>

<p><a name="verify-bug-reports" href="#verify-bug-reports"></a></p>

<h2>Verify Bug Reports</h2>

<p><a name="testing-patches" href="#testing-patches"></a></p>

<h2>Testing Patches</h2>

<h1>Reporting an Issue</h1>

<p><a name="bugs" href="#bugs"></a></p>

<h2>Bugs</h2>

<p><a href='https://github.com/viatropos/tower/issues'>https://github.com/viatropos/tower/issues</a></p>

<p>Please markup your issue with GitHub's markdown code blocks:</p>

<p><div class="highlight"><pre lang=" bash">     info  - socket.io started<br />   [Mon, 23 Apr 2012 16:40:33 GMT] INFO Tower development server listening on port 3000</p>

<p>node.js:201<br />          throw e; // process.nextTick error, or 'error' event on first tick<br />  ...<br />  </pre></div></p>

<p>Your code is wrapped in triple backslashes, and you can specify the language (<code>\</code>`` bash<code>,</code>``` coffeescript<code>,</code>``` javascript<code>,</code>``` ruby<code>,</code>``` html`, etc.)</p>

<p><a name="features" href="#features"></a></p>

<h2>Features</h2>

<p>Add these to the todo wiki's <a href="https://github.com/viatropos/tower/wiki/roadmap#wiki-potential-features">Potential Features</a> section.</p>

<p><a name="questions" href="#questions"></a></p>

<h2>Questions</h2>

<p><a href='http://stackoverflow.com/'>http://stackoverflow.com/</a></p>

<p><a name="discussion" href="#discussion"></a></p>

<h2>Discussion</h2>

<p><a href='https://groups.google.com/group/towerjs'>https://groups.google.com/group/towerjs</a><br /><a href='https://groups.google.com/group/towerjs-dev'>https://groups.google.com/group/towerjs-dev</a></p>

<p><a name="irc" href="#irc"></a></p>

<h2>IRC</h2>

<p>The <code>#towerjs</code> channel on irc.freenode.net.</p>

<p><a name="feedback" href="#feedback"></a></p>

<h2>Feedback</h2>

<p>You're encouraged to help improve the quality of this guide.</p>

<p>If you see any typos or factual errors you are confident to patch, please clone the wiki and push the change yourself. That branch of Tower has public write access. Commits are still reviewed, but that happens after you've submitted your contribution. the wiki is cross-merged with master periodically.</p>

<p>You may also find incomplete content, or stuff that is not up to date. Please do add any missing documentation for master.</p>

<p>If for whatever reason you spot something to fix but cannot patch it yourself, please open an issue.</p>

<p>And last but not least, any kind of discussion regarding Tower documentation is very welcome on the <a href="https://groups.google.com/group/towerjs">Tower Google Group</a>.</p>

<h1>Contributing Translations</h1>

<p><a name="translating-the-tower-guides" href="#translating-the-tower-guides"></a></p>

<h2>Translating the Tower Guides</h2>

<p>It's great to have people volunteer to translate the Tower Guides into their own language.</p>

<p>If you want to launch a translation, you should:</p>

<ol>
<li>Fork the Tower.js wiki</li>
<li>Add folders for your own language (for example, ./pt-BR/guides for Brazilian Portuguese)</li>
<li>Copy the source files from <code>guides</code> to your own language folder, and translate them</li>
</ol>

<p><a name="current-translation-efforts" href="#current-translation-efforts"></a></p>

<h2>Current translation efforts</h2>

<ul>
<li><a href="https://towerjs.jp">Japanese</a></li>
</ul>

<p>Here's how I am going to layout <a href='http://towerjs.org'>http://towerjs.org</a>:</p>

<ul>
<li>/guides (/guides/models, /guides/application, etc.)</li>
<li>/api (generated documentation)</li>
<li>/community (links to github, google group, contributors, etc.)</li>
<li>/roadmap</li>
<li>/examples (list of projects with pictures)</li>
<li>/screencasts</li>
<li>/tests (client test suite)</li>
<li>/contributors</li>
</ul>

<p>The bulk of what you'd be translating would be under /guides (I might call this /docs, not 100% yet).  Currently, those files are in the wiki/docs folder when you clone the wiki. </p>

<p>We said before we were going to go with the <a href='http://towerjs.jp'>http://towerjs.jp</a> domain for both the docs and the group.  My thinking then was, I didn't want to be a bottleneck for you getting your translations out there on the web.  But after further reflection, I think it would be easier and more manageable if everything <em>did</em> go through the main site at <a href='http://towerjs.org'>http://towerjs.org</a>.</p>

<p>The main reason is, you and other contributors who translate Tower into different languages, shouldn't have to purchase a domain and go through the hassle of managing an application on top of all your translation work... that just creates a barrier to writing translations.  If you <em>want</em> to have your own domain and keep the app in sync with the towerjs.org repo, that's totally fine, but I think the default should only require that you just handle the markdown files you're translating.</p>

<p>Here's how we do that.</p>

<p>First, any translation should be accessible from <a href='http://towerjs.org/{locale}'>http://towerjs.org/{locale}</a>, so <a href='http://towerjs.org/ja/docs'>http://towerjs.org/ja/docs</a> or <a href='http://towerjs.org/ja-JP/docs'>http://towerjs.org/ja-JP/docs</a> (not sure the exact locale for Japan).  I may want to make this a subdomain (i.e. <a href='http://ja-JP.towerjs.org/docs'>http://ja-JP.towerjs.org/docs</a>), but for now lets assume it will define a top-level path.</p>

<p>Second, to write the actual translations:</p>

<ol>
<li>clone the wiki (<a href='https://github.com/viatropos/tower/wiki/_access'>https://github.com/viatropos/tower/wiki/_access</a>).</li>
<li>copy/paste the [relevant] wiki pages into the locale (wiki/ja-JP/docs/models.md, etc.).</li>
<li>translate those pages.</li>
<li>submit a pull request.</li>
<li>I'll update the main site.</li>
</ol>

<p>See <a href='https://github.com/viatropos/towerjs.org/blob/master/Cakefile#L102'>https://github.com/viatropos/towerjs.org/blob/master/Cakefile#L102</a> for the markdown files currently being used on the main site.</p>

<p>In the end, this will work a lot like docrails where you just edit markdown files.</p>