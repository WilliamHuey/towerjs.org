<header class="header subhead" id="overview"><h1>Tower Application</h1>

<p>The main application is defined in <code>config/application.coffee</code> and defaults to this:</p>

<pre><code class="coffeescript">class App extends Tower.Application
  @configure -&gt;
    @use &quot;favicon&quot;, Tower.publicPath + &quot;/favicon.ico&quot;
    @use &quot;static&quot;,  Tower.publicPath, maxAge: Tower.publicCacheDuration
    @use &quot;profiler&quot; if Tower.env != &quot;production&quot;
    @use &quot;logger&quot;
    @use &quot;query&quot;
    @use &quot;cookieParser&quot;, Tower.session.secret
    @use &quot;session&quot;, Tower.session.key
    @use &quot;bodyParser&quot;
    @use &quot;csrf&quot;
    @use &quot;methodOverride&quot;, &quot;_method&quot;
    @use Tower.Middleware.Agent
    @use Tower.Middleware.Location
    @use Tower.Middleware.Router
</code></pre>

<p>The <code>configure</code> function is used to configure the application.</p>

<ul>
<li><code>favicon</code> points to the icon file displayed in the browser address bar.</li>
<li><code>static</code> is used to set where public (static) files reside and define their cache duration on the client.</li>
<li><code>profiler</code> is by default configured to only used only when the app is not in production mode (environment).</li>
</ul>

<p>You can of course extend the configure function with your own application configuration logic as needed.</p>
<nav class="subnav"><ul class="nav nav-pills"><li><a href="#structure">structure</a></li><li><a href="#package-json">package-json</a></li><li><a href="#configuration">configuration</a></li><li><a href="#server">server</a></li><li><a href="#client">client</a></li><li><a href="#environments">environments</a></li><li><a href="#dotfiles">dotfiles</a></li><li><a href="#commands">commands</a></li><li><a href="#helpers">helpers</a></li><li><a href="#i18n">i18n</a></li><li><a href="#watchfile">watchfile</a></li></ul></nav></header><section class="section" id="structure"><h1>Structure of a Tower.js Project</h1>

<pre><code>.
|-- app
|   |-- client
|   |   |-- stylesheets
|   |-- controllers
|   |   |-- admin
|   |   |   |-- postsController.coffee
|   |   |   `-- usersController.coffee
|   |   |-- commentsController.coffee
|   |   |-- postsController.coffee
|   |   |-- sessionsController.coffee
|   |   `-- usersController.coffee
|   |-- models
|   |   |-- comment.coffee
|   |   |-- post.coffee
|   |   `-- user.coffee
|   |-- views
|   |   |-- admin
|   |   |   `-- posts
|   |   |       |-- _form.coffee
|   |   |       |-- edit.coffee
|   |   |       |-- index.coffee
|   |   |       |-- new.coffee
|   |   |       |-- show.coffee
|   |   |-- layouts
|   |   |   `-- application.coffee
|   |   |-- shared
|   |   `-- posts
|   |       |-- index.coffee
|   |       `-- show.coffee
|   `-- helpers
|       |-- admin
|       |   |-- postsHelper.coffee
|       |   `-- usersHelper.coffee
|       `-- postsHelper.coffee
`-- config
|    |-- application.coffee
|    |-- assets.coffee
|    |-- bootstrap.coffee
|    |-- databases.coffee
|    |-- preinitializers
|    |-- initializers
|    |-- environments
|       |-- development.coffee
|       |-- production.coffee
|       `-- test.coffee
|    |-- locale
|       `-- en.coffee
|    |-- routes.coffee
`-- test
|    |-- config.coffee
|    |-- models
|    |   |-- postTest.coffee
|    |   |-- userTest.coffee
|    `-- acceptance
|        |-- loginTest.coffee
|        |-- signupTest.coffee
|        `-- postsTest.coffee
</code></pre>
</section><section class="section" id="package-json"><h1>NPM and <code>package.json</code></h1>

<p>The <code>package.json</code> file is standard to all Node.js modules using <a href="http://npmjs.org/">NPM</a> (which implements the <a href="http://wiki.commonjs.org/wiki/Packages/1.1">CommonJS package format specification</a>).</p>

<p>Without going into too much detail, here&#39;s what you need to know about each.</p>

<h2><code>package.json</code></h2>

<p>The <code>package.json</code> file is a JSON description of your project.  This is the default <code>package.json</code> for a generated Tower.js app:</p>

<pre><code class="json">{
  &quot;name&quot;:                 &quot;my-app&quot;,
  &quot;version&quot;:              &quot;0.0.1&quot;,
  &quot;description&quot;:          &quot;Some one-liner description of your project.&quot;,
  &quot;homepage&quot;:             &quot;http://github.com/username/my-app&quot;,
  &quot;main&quot;:                 &quot;./server.js&quot;,
  &quot;author&quot;:               &quot;Your Name &lt;your@email.com&gt;&quot;,
  &quot;keywords&quot;: [
    &quot;node&quot;
  ],
  &quot;maintainers&quot;: [{
    &quot;name&quot;:               &quot;Your Name&quot;,
    &quot;email&quot;:              &quot;your@email.com&quot;
  }],
  &quot;contributors&quot;: [

  ],
  &quot;licenses&quot;: [
    {
      &quot;type&quot;:             &quot;MIT&quot;,
      &quot;url&quot;:              &quot;http://mths.be/mit&quot;
    }
  ],
  &quot;bugs&quot;: {
    &quot;url&quot;:                &quot;http://github.com/username/my-app/issues&quot;
  },
  &quot;repository&quot;: {
    &quot;type&quot;:               &quot;git&quot;,
    &quot;url&quot;:                &quot;http://github.com/username/my-app.git&quot;
  },
  &quot;engines&quot;: {
    &quot;node&quot;:               &quot;&gt;= 0.4.0&quot;
  },
  &quot;dependencies&quot;: {
    &quot;tower&quot;:              &quot;&gt;= 0.3.0&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;coffee-script&quot;:      &quot;&gt;= 1.1.3&quot;,
    &quot;stylus&quot;:             &quot;&gt;= 0.17.0&quot;,
    &quot;uglify-js&quot;:          &quot;&gt;= 1.1.1&quot;,
    &quot;design.io&quot;:          &quot;&gt;= 0.1.0&quot;
  }
}
</code></pre>

<p>For all node modules that you&#39;ll need in both development and production environments, put them into <code>dependencies</code>.  Anything that you just need for development (like <code>uglify-js</code> for javascript compression), put that into <code>devDependencies</code>.</p>

<p>To install just production dependencies, run this command from your project root:</p>

<pre><code>npm install --production
</code></pre>

<p>You can also do this by setting <code>NODE_ENV</code> to <code>production</code>.</p>

<p>To install both <code>dependencies</code> and <code>devDependencies</code>, run this command:</p>

<pre><code>npm install
</code></pre>

<p><strong>Note</strong>: When you push your app to Heroku, it&#39;s compiled to a &quot;slug&quot;.  This makes it easy to clone and scale your app.  The ideal is to minimize the size of that slug so it&#39;s faster to clone.  The two biggest ways to do this are 1) minimize the number of images/pdfs/assets in your project (put them on S3 or something), and 2) minimize the number of modules you use in production.  So if you only need gzipping to compile your assets for production, put that into your <code>devDependencies</code>.</p>

<h2>NPM</h2>

<p>Most of you are probably familiar with NPM, but here&#39;s just a quick list of helpful commands to streamline your development workflow.</p>

<p>More on NPM here: <a href="http://npmjs.org/doc">http://npmjs.org/doc</a>.</p>

<h3><code>npm install</code></h3>

<p>The first thing to do when you create a Tower project (or you <code>git clone</code> any node module from GitHub) is to <code>cd</code> into the project root and install the dependencies:</p>

<pre><code>npm install
</code></pre>

<p>You can install a published npm module like this:</p>

<pre><code>npm install coffee-script jade stylus
</code></pre>

<p>You can also install local modules:</p>

<pre><code>npm install /Users/username/git/node/my-module
</code></pre>

<p>But when you&#39;re developing a module locally, it&#39;s a pain to constantly have to remove and reinstall it into the app that&#39;s using it.  That&#39;s where <code>npm link</code> comes in.</p>

<h3><code>npm link</code></h3>

<p>The <code>npm link</code> command creates a symlink to a local node module that links it to the global npm module directory on your hard drive.  First step is to link <code>my-module</code> to the global directory:</p>

<pre><code>$ cd /Users/username/git/node/my-module
$ npm link
/usr/local/lib/node_modules/my-module -&gt; /Users/username/git/node/my-module
</code></pre>

<p>Then in any local project that&#39;s using it, run:</p>

<pre><code>$ npm link my-module
./node_modules/my-module -&gt; /usr/local/lib/node_modules/my-module -&gt; /Users/username/git/node/my-module
</code></pre>

<p>I love <code>npm link</code>, it makes development so much easier.</p>

<h3><code>npm publish</code></h3>

<p>To publish a module to the npm index, run:</p>

<pre><code>npm publish
</code></pre>

<h3>NPM Scripts</h3>

<p>Sometimes you want to run some code before/after your module is installed. Do this by defining npm <code>scripts</code> in your <code>package.json</code> (<a href="http://npmjs.org/doc/scripts.html">http://npmjs.org/doc/scripts.html</a>).</p>

<p>Here&#39;s a <code>package.json</code> that installs a RubyGem after the node module is installed:</p>

<pre><code class="json">{
  ...
  &quot;scripts&quot;: {
    &quot;install&quot;: &quot;gem install nokogiri&quot;
  }
}
</code></pre>

<p>Run custom scripts like this:</p>

<pre><code>npm run-script docs
</code></pre>

<h2>References</h2>

<ul>
<li><a href="http://npmjs.org/doc/json.html">http://npmjs.org/doc/json.html</a></li>
<li><a href="http://npmjs.org/doc/config.html">http://npmjs.org/doc/config.html</a></li>
</ul>
</section><section class="section" id="configuration"><h1>Configuration</h1>
</section><section class="section" id="server"><h1>The Server</h1>

<h2>Auto-reloading Changed Files</h2>

<p>Internally Tower.js knows when a file was changed.  So when you refresh http://localhost:3000, it passes through the <code>Tower.Middleware.Dependencies</code> which re-requires any file that has changed.  This makes development uber fast, and prevents you from having to restart the server whenever a file changes (i.e. <a href="https://github.com/remy/nodemon">nodemon</a>).  I mean, you can use nodemon if you want, it&#39;s a great project.  But you don&#39;t need to.</p>
</section><section class="section" id="client"><h1>The Client</h1>

<p>The client application is defined exactly like the server application, they just tend to require different middleware and slightly different configuration.</p>
</section><section class="section" id="environments"><h1>Environments</h1>

<p>Tower by default comes with the following environments:</p>

<ul>
<li>development</li>
<li>test</li>
<li>production</li>
</ul>

<p>Additional environments can be defined if needed (such as staging).</p>
</section><section class="section" id="dotfiles"><h1>Dotfiles</h1>

<p><a href="https://github.com/search?q=dotfiles&amp;type=Everything&amp;repo=&amp;langOverride=&amp;start_value=1">Dotfiles</a> are for the most part just hidden files that different platforms use to store configuration data about your project.</p>

<p>In Tower.js, there&#39;s 3 by default:</p>

<ul>
<li><code>.gitignore</code> Tells git the files and directories it should ignore.</li>
<li><code>.npmignore</code> Tells npm what to ignore when your module is published.</li>
<li><code>.slugignore</code> Tells Heroku what to ignore about your project.</li>
</ul>
</section><section class="section" id="commands"><h1>Tower console commands</h1>

<h2>New app</h2>

<pre><code>tower new &lt;app-name&gt; [options]
</code></pre>

<h2>Server</h2>

<pre><code>tower server
</code></pre>

<blockquote>
<p>Note: <code>node server</code> works well and is pure node.</p>
</blockquote>

<h2>Console</h2>

<p>Use the Tower.js console to programmatically mess around with your application data.</p>

<pre><code>tower console
</code></pre>

<p>You can also run the console in CoffeeScript!</p>

<pre><code>tower console -c
</code></pre>

<h2>Generators</h2>

<pre><code>tower generate &lt;generator&gt; [args] [options]
</code></pre>

<p>See the available Generators for details on how to use them.</p>

<h3>Generate Modules (todo)</h3>

<pre><code>tower generate module my-library
</code></pre>
</section><section class="section" id="helpers"><h1>Helpers</h1>

<p>Most helpers in Tower are included in the underscore <code>_</code> namespace, because they are generic enough to be useable outside of Tower itself.  The rest are included in the <code>Tower</code> namespace.</p>

<h2>Tower Helpers</h2>

<pre><code class="coffeescript">Tower.urlFor
Tower.get
Tower.post
Tower.put
Tower.action
Tower.constant
</code></pre>

<h2>Underscore Helpers</h2>

<h3>String Helpers</h3>

<h4><code>_.pluralize</code></h4>

<pre><code class="coffeescript">_.pluralize(&#39;business&#39;)   #=&gt; &#39;businesses&#39;
_.pluralize(&#39;businesses&#39;) #=&gt; &#39;businesses&#39;
_.pluralize(&#39;person&#39;)     #=&gt; &#39;people&#39;
_.pluralize(&#39;people&#39;)     #=&gt; &#39;people&#39;
</code></pre>

<h4><code>_.singularize</code></h4>

<pre><code class="coffeescript">_.singularize(&#39;business&#39;)   #=&gt; &#39;business&#39;
_.singularize(&#39;businesses&#39;) #=&gt; &#39;business&#39;
_.singularize(&#39;person&#39;)     #=&gt; &#39;person&#39;
_.singularize(&#39;people&#39;)     #=&gt; &#39;person&#39;
</code></pre>

<h3>Object Helpers</h3>

<h4><code>_.isHash</code></h4>

<pre><code class="coffeescript">_.isHash({}) #=&gt; true
_.isHash({key: &#39;value&#39;}) #=&gt; true
_.isHash(new App.User) #=&gt; false
</code></pre>

<h4><code>_.isObject</code></h4>

<pre><code class="coffeescript">_.isObject({})              #=&gt; true
_.isObject({key: &#39;value&#39;})  #=&gt; true
_.isObject(new App.User)    #=&gt; true
</code></pre>

<h3>Date Helpers</h3>

<pre><code class="coffeescript">_(number)[interval]()[timeframe]()
_(2).days().fromNow().toDate()
_(3).years().ago().toDate()
_(&#39;Dec 25, 2012&#39;).toDate()
</code></pre>

<h3>Validation Helpers</h3>
</section><section class="section" id="i18n"><h1>Internationalization (I18n)</h1>

<pre><code class="coffeescript"># config/locales/en.coffee
module.exports =
  hello: &quot;world&quot;
  forms:
    titles:
      signup: &quot;Signup&quot;
  pages:
    titles:
      home: &quot;Welcome to %{site}&quot;
  posts:
    comments:
      none: &quot;No comments&quot;
      one: &quot;1 comment&quot;
      other: &quot;%{count} comments&quot;
  messages:
    past:
      none: &quot;You never had any messages&quot;
      one: &quot;You had 1 message&quot;
      other: &quot;You had %{count} messages&quot;
    present:
      one: &quot;You have 1 message&quot;
    future:
      one: &quot;You might have 1 message&quot;
</code></pre>

<p>Tower also has some more internal locale files for system generated text such as dates and times etc.
You can provide your own locale files for these as well (see the Tower src code and look for /locale folders).  </p>
</section><section class="section" id="watchfile"><h1>Watchfile</h1>

<p>Tower uses <a href="https://github.com/viatropos/design.io">design.io</a>&#39;s <code>Watchfile</code> to:</p>

<ul>
<li>Automatically compile assets when they are added, saved, or removed.  See the <a href="/assets/pipeline">Tower Asset Pipeline</a></li>
<li>Automatically restart the server in development mode when you modify a file</li>
<li>Push compiled CSS and JavaScripts to the browser as you&#39;re developing without refreshing the browser!</li>
<li>Automatically run tests across browsers, platforms, and devices as your developing.</li>
<li>Give you space to add more <code>watch</code> tasks to streamline workflow</li>
</ul>

<h2>Default Watchfile</h2>

<pre><code class="coffeescript">require(&#39;design.io&#39;).extension(&#39;watchfile&#39;)

require(&quot;design.io-stylesheets&quot;)
  compress: false
  ignore: /(public|node_modules)/
  paths:  File.directories(&quot;app/assets&quot;).concat File.directories(&quot;themes&quot;)
  write: (path, string) -&gt;
    path = &quot;public/stylesheets/#{path}&quot;.replace(/\.(css|styl|less)/, &quot;.css&quot;)
    try
      File.write path, string, (error) -&gt;
        console.log(error.stack) if error
    catch error
      console.log error.stack

require(&quot;design.io-javascripts&quot;)
  compress: false
  debug:    false
  ignore:   /(public|node_modules|server|spec.*[sS]pec)/
  #outputPath: (path) -&gt;
  #  &quot;spec/tmp/test.css&quot;
  write: (path, string) -&gt;
    path = &quot;public/javascripts/#{path}&quot;.replace(/\.(js|coffee)/, &quot;.js&quot;)
    #growl.notify(&quot;updated #{path}&quot;, { title: &#39;Stylesheets&#39; })
    try
      File.write path, string, (error) -&gt;
        console.log(error.stack) if error
    catch error
      console.log error.stack

# update .coffee file when .mustache file of same name changes
watch /app\/views.*\.mustache/
  update: (path, callback) -&gt;
    coffeePath = path.replace(&quot;.mustache&quot;, &quot;.coffee&quot;)
    if File.exists coffeePath
      File.touch coffeePath
    callback()
</code></pre>
</section>