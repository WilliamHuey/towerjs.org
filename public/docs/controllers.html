<header class="header subhead" id="overview"><h1>Controllers</h1>
<nav class="subnav"><ul class="nav nav-pills"><li><a href="#actions">actions</a></li><li><a href="#events">events</a></li><li><a href="#params">params</a></li><li><a href="#rendering">rendering</a></li><li><a href="#resources">resources</a></li><li><a href="#routes">routes</a></li></ul></nav></header><section class="section" id="actions"><h1>Actions</h1>

<p>By convention there are 7 RESTful actions for a controller:</p>

<ol>
<li><code>index</code>: Show all resources (<code>GET</code>)</li>
<li><code>new</code>: Build a new resource and render a form (<code>GET</code>)</li>
<li><code>create</code>: Create a new resource (<code>POST</code>)</li>
<li><code>show</code>: Find and show a resource by id (<code>GET</code>)</li>
<li><code>edit</code>: Find a resource by id and render it in a form to edit (<code>GET</code>)</li>
<li><code>update</code>: Update an existing resource (<code>PUT</code>)</li>
<li><code>destroy</code>: Destroy an existing resource (<code>DELETE</code>)</li>
</ol>

<p>If you wanted to manually write out simple controller actions, this is how you might do it:</p>

<pre><code class="coffeescript">class App.PostsController extends Tower.Controller
  index: -&gt;
    App.Post.all (error, posts) =&gt;
      @render &quot;index&quot;, locals: posts: posts

  new: -&gt;
    post = new App.Post
    @render &quot;new&quot;, locals: post: post

  create: -&gt;
    App.Post.create @params.post, (error, post) =&gt;
      @redirectTo post

  show: -&gt;
    App.Post.find @params.id (error, post) =&gt;
      @render &quot;show&quot;, locals: post: post

  edit: -&gt;
    App.Post.find @params.id (error, post) =&gt;
      @render &quot;edit&quot;, locals: post: post

  update: -&gt;
    App.Post.find @params.id (error, post) =&gt;
      post.updateAttributes @params.post, (error) =&gt;
        if error
          @render &quot;edit&quot;, locals: post: post
        else
          @redirectTo post

  destroy: -&gt;
    App.Post.find @params.id (error, post) =&gt;
      post.destroy (error) =&gt;
        @redirectTo &quot;index&quot;
</code></pre>

<p><strong>Note</strong>: The above actions won&#39;t respond to different content types differently (i.e. for json, give me a json string, for html give me some rendered html).  But for some cases that&#39;s all you need.</p>

<p>In order for those actions to be accessible, routes must be defined.  Routes to all 7 RESTful actions are generated with the following declaration in <code>config/routes.coffee</code>:</p>

<pre><code class="coffeescript">Tower.Route.draw -&gt;
  @resources &quot;posts&quot;
</code></pre>

<p>More on routes in the <a href="/docs/routes">routes section</a>.</p>

<h2>Custom Actions</h2>

<p>Sometimes RESTful actions aren&#39;t enough.  To add custom actions, just add a route mapping to the method name for the controller.</p>

<pre><code class="coffeescript">Tower.Route.draw -&gt;
  @resources &quot;posts&quot;, -&gt;
    @get &quot;dashboard&quot;
</code></pre>

<p><strong>Note</strong>: If you start thinking you need to add a custom action to your controller, I personally recommend asking the community (stack overflow, twitter, github, etc.) if there&#39;s a way to fit it into the paradigm.  Several times I thought &quot;this is the one time I need a custom action&quot;, but 99% of the time I found a way to fit it in.  This always simplified the system.</p>
</section><section class="section" id="events"><h1>Events</h1>

<p>All controller actions are just events.  This means then that controllers handle events:</p>

<ul>
<li>DOM events</li>
<li>socket messages</li>
<li>url requests</li>
</ul>

<p>Instead of having to create a controller for each type of message, why not just establish some conventions:</p>

<pre><code class="coffeescript">class App.PostsController extends Tower.Controller
  # socket.io handler
  @on &quot;create&quot;, &quot;syncCreate&quot; # created by default... knows because it&#39;s named after an action
  @on &quot;notification&quot;, &quot;flashMessage&quot; # knows it&#39;s socket because &#39;notification&#39; isn&#39;t an action or dom event keyword
  @on &quot;mousemove&quot;, &quot;updateHeatMap&quot;, type: &#39;socket&#39; # if you name a socket event after a keyword then pass the `type: &#39;socket&#39;` option.

  # dom event handler
  @on &quot;click&quot;, &quot;click&quot;
  @on &quot;click .item a&quot;, &quot;clickItem&quot;
  # or as an object
  @on &quot;click .itemA a&quot;: &quot;clickItemA&quot;,
    &quot;click .itemB a&quot;: &quot;clickItemB&quot;,
    &quot;click .itemC a&quot;: &quot;clickItemC&quot;

  @on &quot;change #user-first-name-input&quot;, &quot;enable&quot;, dependent: &quot;#user-last-name-input&quot;
  @on &quot;change #user-first-name-input&quot;, &quot;enable #user-last-name-input&quot; # enable: (selector)
  @on &quot;change #user-first-name-input&quot;, &quot;validate&quot;
  @on &quot;change #user-first-name-input&quot;, bind: &quot;firstName&quot;
  @bind &quot;change #user-first-name-input&quot;, &quot;firstName&quot;
  @on &quot;click #add-user-address&quot;, &quot;addAddress&quot;
  @on &quot;click #add-user-address&quot;, &quot;add&quot;, object: &quot;address&quot;
  @on &quot;click #remove-user-address&quot;, &quot;removeAddress&quot;
  # $(window).on(&#39;click&#39;, &#39;#user-details&#39;, &quot;toggleDetails&quot;);
  @on &quot;click #user-details&quot;, &quot;toggleDetails&quot;

  # show or hide
  toggleShowHide: -&gt;

  show: -&gt;

  hide: -&gt;

  toggleSelectDeselect: -&gt;

  select: -&gt;

  deselect: -&gt;

  toggleAddRemove: -&gt;

  add: -&gt;

  remove: -&gt;

  toggleEnableDisable: -&gt;  
    if _.blank(value)
      @disable()
    else
      @enable()

  # enable or disable
  enable: -&gt;
    $(options.dependent).attr(&quot;disabled&quot;, false)

  disable: -&gt;
    $(options.dependent).attr(&quot;disabled&quot;, true)

  validate: (element) -&gt;
    element

  invalidate: -&gt;

  bind: -&gt;

  next: -&gt;

  prev: -&gt;
</code></pre>
</section><section class="section" id="params"><h1>Params</h1>

<p>You can define parameters which should be parsed into a <code>Tower.Model.Criteria</code>.  This allows you to build a very robust query api with minimal effort.</p>

<p>Tower uses a set of pseudo-ruby conventions for defining ranges and sets of values to query by.  They are defined with the <code>@param</code> class method on a controller.  Tower looks for the attribute definition on the model class associated with the controller, unless you have specified the <code>type</code> option.</p>

<pre><code class="coffeescript">class App.EventsController extends Tower.Controller
  @param &quot;title&quot;
  @param &quot;createdAt&quot;
  @param &quot;memberCount&quot;
  @param &quot;tags&quot;, type: &quot;Array&quot;
  @param &quot;coordinates&quot;
  @param &quot;admin&quot;, source: &quot;admin.firstName&quot;

  index: -&gt;
    App.Event.where(@criteria()).all (error, events) =&gt;
      @render json: events
</code></pre>

<ul>
<li><code>String</code></li>
<li><code>Date</code></li>
<li><code>Array</code></li>
<li><code>Number</code></li>
<li><code>Order</code></li>
<li><code>Coordinates</code></li>
</ul>

<h2><code>String</code></h2>

<h3>Query</h3>

<pre><code class="coffeescript">title=Hello+World
title=Hello+-World
title=&#39;Hello+World&#39;
</code></pre>

<h3>Criteria</h3>

<pre><code class="coffeescript">{ &quot;title&quot; : { &quot;$match&quot; : [&quot;Hello&quot;, &quot;World&quot;] } }
{ &quot;title&quot; : { &quot;$match&quot; : [&quot;Hello&quot;], &quot;$notMatch&quot; : [&quot;World&quot;] } }
{ &quot;title&quot; : { &quot;$match&quot; : [&quot;Hello World&quot;] } }
</code></pre>

<h2><code>Date</code></h2>

<h3>Query</h3>

<pre><code class="coffeescript">createdAt=12-31-2011
createdAt=12-31-2011..t
createdAt=t..12-31-2011
createdAt=12-21-2011..12-31-2011
createdAt=12-21-2011..12-31-2011,01-04-2012
</code></pre>

<h3>Criteria</h3>

<pre><code class="coffeescript">{ &quot;createdAt&quot; : Date(12-31-2011) }
{ &quot;createdAt&quot; : { &quot;$gte&quot;: Date(12-31-2011) } }
{ &quot;createdAt&quot; : { &quot;$lte&quot;: Date(12-31-2011) } }
{ &quot;createdAt&quot; : { &quot;$gte&quot;: Date(12-21-2011), &quot;$lte&quot;: Date(12-31-2011) } }
{ &quot;$or&quot;: [ { &quot;createdAt&quot; : { &quot;$gte&quot;: Date(12-21-2011), &quot;$lte&quot;: Date(12-31-2011) } }, { &quot;createdAt&quot; : Date(01-04-2012) } ] }
</code></pre>

<h2><code>Number</code></h2>

<h3>Query</h3>

<pre><code class="coffeescript">likeCount=1
likeCount=1..n
likeCount=n..100
likeCount=1..100
likeCount=1..100,1000
likeCount=-10
likeCount=^10
likeCount=^10,1000
likeCount=^10..1000
likeCount=^-1000
</code></pre>

<h3>Criteria</h3>

<pre><code class="coffeescript">{ &quot;likeCount&quot; : 1 }
{ &quot;likeCount&quot; : { &quot;$gte&quot;: 1 } }
{ &quot;likeCount&quot; : { &quot;$lte&quot;: 1 } }
{ &quot;likeCount&quot; : { &quot;$gte&quot;: 1, &quot;$lte&quot;: 100 } }
{ &quot;$or&quot;: [{ &quot;likeCount&quot; : { &quot;$gte&quot;: 1, &quot;$lte&quot;: 100 } }, { &quot;likeCount&quot; : 1000 }] }
{ &quot;likeCount&quot;: -10 }
{ &quot;likeCount&quot;: { &quot;$neq&quot;: -10 } }
{ &quot;likeCount&quot;: { &quot;$neq&quot;: 10, &quot;$in&quot;: [1000] } }
{ &quot;nor&quot;: [ { &quot;likeCount&quot; : { &quot;$gte&quot;: 10, &quot;$lte&quot;: 1000 } } ] }
{ &quot;likeCount&quot;: { &quot;$neq&quot;: -1000 } }
</code></pre>

<h2><code>Array</code></h2>

<h3>Query</h3>

<pre><code class="coffeescript">tags=javascript
tags=^java
tags=ruby,^java
tags=[ruby,javascript]
</code></pre>

<h3>Criteria</h3>

<pre><code class="coffeescript">{ &quot;tags&quot; : { &quot;$in&quot;: [&quot;javascript&quot;] } }
{ &quot;tags&quot; : { &quot;$nin&quot;: [&quot;java&quot;] } }
{ &quot;tags&quot; : { &quot;$in&quot;: [&quot;ruby&quot;], &quot;$nin&quot;: [&quot;java&quot;] } }
{ &quot;tags&quot; : { &quot;$all&quot;: [&quot;ruby&quot;, &quot;javascript&quot;] } }
</code></pre>

<h2><code>Coordinates</code></h2>

<h3>Query</h3>

<pre><code class="coffeescript">coordinates=51.509981,-0.074704
coordinates=51.509981,-0.074704,10
</code></pre>

<h3>Criteria</h3>

<pre><code class="coffeescript">{ &quot;coordinates&quot; : { &quot;$near&quot;: [51.509981, -0.074704] } }
{ &quot;coordinates&quot; : { &quot;$near&quot;: [51.509981, -0.074704] , &quot;$maxDistance&quot; : 10 } }
</code></pre>

<h2><code>Order</code></h2>

<h3>Query</h3>

<pre><code class="coffeescript">sort=title
sort=title+
sort=title-
sort=createdAt-,title
sort=createdAt+,title+
</code></pre>

<h3>Criteria</h3>

<pre><code class="coffeescript">{ &quot;sort&quot; : [[&quot;title&quot;, &quot;asc&quot;]] }
{ &quot;sort&quot; : [[&quot;title&quot;, &quot;asc&quot;]] }
{ &quot;sort&quot; : [[&quot;title&quot;, &quot;desc&quot;]] }
{ &quot;sort&quot; : [[&quot;createdAt&quot;, &quot;desc&quot;], [&quot;title&quot;, &quot;asc&quot;]] }
{ &quot;sort&quot; : [[&quot;createdAt&quot;, &quot;asc&quot;], [&quot;title&quot;, &quot;asc&quot;]] }
</code></pre>

<h2>Examples</h2>

<pre><code class="coffeescript">http://events.towerjs.org/?createdAt=12-25-2011
http://events.towerjs.org/?createdAt=12-25-2011..12-31-2011
http://events.towerjs.org/?tags=javascript,ruby
http://events.towerjs.org/?memberCount=10..n
http://events.towerjs.org/?sort=createdAt-,title+
http://events.towerjs.org/?createdAt=12-25-2011..12-31-2011&amp;tags=javascript,ruby
http://events.towerjs.org/?createdAt=12-25-2011..12-31-2011&amp;tags=javascript,ruby&amp;sort=createdAt-,title+
http://events.towerjs.org/?createdAt=12-25-2011..12-31-2011&amp;tags=javascript,ruby&amp;memberCount=10..n&amp;sort=createdAt-,title+
http://events.towerjs.org/?createdAt=12-25-2011..12-31-2011&amp;tags=javascript,ruby&amp;memberCount=10..n&amp;coordinates=51.509981,-0.074704,10&amp;sort=createdAt-,title+
</code></pre>

<p>The last url above would generate the criteria:</p>

<pre><code class="coffeescript">{ 
  &quot;coordinates&quot; : { &quot;$near&quot;: [51.509981, -0.074704] , &quot;$maxDistance&quot; : 10 },
  &quot;createdAt&quot; : { &quot;$gte&quot;: Date(12-21-2011), &quot;$lte&quot;: Date(12-31-2011) },
  &quot;memberCount&quot; : { &quot;$gte&quot;: 10 },
  &quot;sort&quot; : [[&quot;createdAt&quot;, &quot;desc&quot;], [&quot;title&quot;, &quot;asc&quot;]], 
  &quot;tags&quot; : { &quot;$in&quot;: [&quot;ruby&quot;, &quot;javascript&quot;] }
}
</code></pre>

<h3><code>OR</code> Queries Over Several Attributes</h3>

<p>You can do <code>OR</code> searches over several attributes, i.e. &quot;find all posts in the past 2 days OR those tagged with &#39;javascript&#39;&quot;.  Just prepend each <code>OR</code> block with an array index:</p>

<pre><code class="coffeescript"># find all posts between christmas and new years eve, or those tagged with &quot;javascript&quot; and &quot;ruby&quot;, then sort by date and title
[0]createdAt=12-25-2011..12-31-2011&amp;[1]tags=javascript,ruby&amp;sort=createdAt-,title+
createdAt[0]=12-25-2011..12-31-2011&amp;tags[1]=javascript,ruby&amp;sort=createdAt-,title+
</code></pre>

<h2>Nested</h2>
</section><section class="section" id="rendering"><h1>Rendering</h1>

<ul>
<li>Templates</li>
<li>JSON</li>
<li>The Rendering Process</li>
</ul>

<h2>Templates</h2>

<pre><code class="coffeescript">class App.PostsController extends Tower.Controller
  index: -&gt;
    @render &quot;index&quot;
</code></pre>

<h2>JSON</h2>

<pre><code class="coffeescript">class App.PostsController extends Tower.Controller
  show: -&gt;
    App.Post.find @params.id, (error, post) =&gt;
      @render json: post
</code></pre>

<h2>The Rendering Process</h2>

<h3><code>respondWith</code></h3>

<pre><code class="coffeescript">show: -&gt;
  App.Post.find @params.id, (error, post) =&gt;
    @respondWith post, (format) =&gt;
      format.html =&gt; @render &quot;show&quot;
</code></pre>

<p>This will perform <em>content negotiation</em>, i.e. it will figure out what the mime type the browser prefers and run the corresponding responder method (for html, json, csv, etc.).  Those methods then call the <code>render</code> method.</p>

<h3><code>render</code></h3>

<pre><code class="coffeescript">show: -&gt;
  App.Post.find @params.id, (error, post) =&gt;
    @render &quot;show&quot;
</code></pre>

<p>Calling the render method directly forces a specific content type to be rendered.  Here is the method signature:</p>

<pre><code class="coffeescript">render json: {hello: &quot;world&quot;}
render &quot;show&quot;                 # render action: &quot;show&quot;
render &quot;posts/show&quot;           # render file: &quot;posts/show&quot;
render -&gt; h1 &quot;Hello World&quot;
render text: &quot;success&quot;, status: 200
</code></pre>

<h3><code>_normalizeRender</code></h3>

<p>This converts the render arguments into a normalized options hash.</p>

<h3><code>_renderToBody</code></h3>

<h3><code>_renderOption</code></h3>

<h3><code>_renderTemplate</code></h3>
</section><section class="section" id="resources"><h1>Resources</h1>

<p>Tower goes by the convention that every controller represents one resource, one model.</p>

<p>A controller doesn&#39;t <em>need</em> to follow these conventions, for example with a <code>DashboardController</code> or <code>SearchController</code>.  In those cases, overriding the methods starts you with a clean slate.  However, you&#39;ll quickly see how powerful this is.</p>

<h2>The Resource</h2>

<p>You can customize the variable names and resource type:</p>

<pre><code class="coffeescript">class App.PostsController extends Tower.Controller
  @resource type: &quot;Article&quot;, collection: &quot;articles&quot;, resource: &quot;article&quot;, key: &quot;data&quot;, id: &quot;dataId&quot;
</code></pre>

<h2>Internals</h2>

<p>The default implementation for a <code>Tower.Controller</code> looks like this:</p>

<pre><code class="coffeescript">class App.PostsController extends Tower.Controller
  index: -&gt;

  new: -&gt;

  create: -&gt;

  show: -&gt;

  edit: -&gt;

  update: -&gt;

  destroy: -&gt;
</code></pre>
</section><section class="section" id="routes"><h1>Routes</h1>

<p>Tower routes are modeled after Rails&#39; routes.  Here&#39;s how you might write a few for a blogging app:</p>

<pre><code class="coffeescript">Tower.Route.draw -&gt;
  @match &quot;/login&quot;, to: &quot;sessions#new&quot;, via: &quot;get&quot;, as: &quot;login&quot;

  @resources &quot;posts&quot;, -&gt;
    @resources &quot;comments&quot;

  @namespace &quot;admin&quot;, -&gt;
    @resources &quot;posts&quot;, -&gt;
      @resources &quot;comments&quot;, only: &quot;index&quot;

    @resources &quot;users&quot;, -&gt;
      @resources &quot;comments&quot;, only: &quot;index&quot;

  @namespace &quot;mobile&quot;, constraints: {subdomain: /^mobile$/}, -&gt;
    @root &quot;/&quot;, to: &quot;mobile#index&quot;

  @match &quot;(/*path)&quot;, to: &quot;application#index&quot;
</code></pre>

<h2>Resourceful Routes</h2>

<pre><code class="coffeescript">Tower.Route.draw -&gt;
  # this...
  @resources &quot;posts&quot;

  # is equivalent to this...
  @match &quot;/posts&quot;,          to: &quot;posts#index&quot;,    via: &quot;get&quot;
  @match &quot;/posts/new&quot;,      to: &quot;posts#new&quot;,      via: &quot;get&quot;
  @match &quot;/posts&quot;,          to: &quot;posts#create&quot;,   via: &quot;post&quot;
  @match &quot;/posts/:id&quot;,      to: &quot;posts#show&quot;,     via: &quot;get&quot;
  @match &quot;/posts/:id/edit&quot;, to: &quot;posts#edit&quot;,     via: &quot;get&quot;
  @match &quot;/posts/:id&quot;,      to: &quot;posts#update&quot;,   via: &quot;put&quot;
  @match &quot;/posts/:id&quot;,      to: &quot;posts#destroy&quot;,  via: &quot;delete&quot;
</code></pre>

<h2>Nesting Routes</h2>

<pre><code class="coffeescript">
</code></pre>

<h2>Hardcore Routing Example</h2>

<p>Here is a complete example straight from the Rails 3.2 test suite, soon to be in the Tower test suite.</p>

<pre><code class="coffeescript">Tower.Route.draw -&gt;
  @defaultUrlOptions host: &quot;towerjs.org&quot;
  @resourcesPathNames correlationIndexes: &quot;infoAboutCorrelationIndexes&quot;

  @controller &quot;sessions&quot;, -&gt;
    @get  &quot;login&quot;: &quot;new&quot;
    @post &quot;login&quot;: &quot;create&quot;
    @destroy &quot;logout&quot;: &quot;destroy&quot;

  @resource &quot;session&quot;, -&gt;
    @get &quot;create&quot;
    @post &quot;reset&quot;

    @resource &quot;info&quot;

    @member, -&gt;
      @get &quot;crush&quot;

  @scope &quot;bookmark&quot;, controller: &quot;bookmarks&quot;, as: &quot;bookmark&quot;, -&gt;
    @get  &quot;new&quot;, path: &quot;build&quot;
    @post &quot;create&quot;, path: &quot;create&quot;, as: &quot;&quot;
    @put  &quot;update&quot;
    @get  &quot;remove&quot;, action: &quot;destroy&quot;, as: &quot;remove&quot;

  @scope &quot;pagemark&quot;, controller: &quot;pagemarks&quot;, as: &quot;pagemark&quot;, -&gt;
    @get  &quot;new&quot;, path: &quot;build&quot;
    @post &quot;create&quot;, as: &quot;&quot;
    @put  &quot;update&quot;
    @get  &quot;remove&quot;, action: &quot;destroy&quot;, as: &quot;remove&quot;

  @match &quot;account/logout&quot;: redirect(&quot;/logout&quot;), as: &quot;logoutRedirect&quot;
  @match &quot;account/login&quot;, to: redirect(&quot;/login&quot;)
  @match &quot;secure&quot;, to: redirect(&quot;/secure/login&quot;)

  @match &quot;mobile&quot;, to: redirect(subdomain: &quot;mobile&quot;)
  @match &quot;superNewDocumentation&quot;, to: redirect(host: &quot;super-docs.com&quot;)

  @match &quot;youtubeFavorites/&quot;youtubeId&quot;/&quot;name&quot;&quot;, to: redirect(YoutubeFavoritesRedirector)

  @constraints ((request) -&gt; true), -&gt;
    @match &quot;account/overview&quot;

  @match &quot;/account/nested/overview&quot;
  @match signIn: &quot;sessions#new&quot;

  @match &quot;account/modulo/:name&quot;, to: @redirect(&quot;/%{name}s&quot;)
  @match &quot;account/proc/:name&quot;, to: @redirect((params, request) -&gt; &quot;/#{params.name.pluralize}&quot;)
  @match &quot;account/procReq&quot;: @redirect((params, request) &quot;/#{req.method}&quot;)

  @match &quot;account/google&quot;: @redirect(&quot;http://www.google.com/&quot;, status: 302)

  @match &quot;openid/login&quot;, via: [&quot;get&quot;, &quot;post&quot;], to: &quot;openid#login&quot;

  @controller &quot;global&quot;, -&gt;
    @get   &quot;global/hideNotice&quot;
    @match &quot;global/export&quot;,      to: &quot;export&quot;, as: &quot;exportRequest&quot;
    @match &quot;/export/&quot;id&quot;/&quot;file&quot;&quot;,  to: &quot;export&quot;, as: &quot;exportDownload&quot;, constraints: { file: /.*/ }
    @match &quot;global/&quot;action&quot;&quot;

  @match &quot;/local/&quot;action&quot;&quot;, controller: &quot;local&quot;

  @match &quot;/projects/status(.&quot;format&quot;)&quot;
  @match &quot;/404&quot;, to: lambda { |env| [404, {&quot;Content-Type&quot;: &quot;text/plain&quot;}, [&quot;NOT FOUND&quot;]] }

  @constraints(ip: /192\.168\.1\.\d\d\d/), -&gt;
    @get &quot;admin&quot;: &quot;queenbee#index&quot;

  @constraints :&quot;TestRoutingMapper&quot;:&quot;IpRestrictor&quot;, -&gt;
    @get &quot;admin/accounts&quot;: &quot;queenbee#accounts&quot;

  @get &quot;admin/passwords&quot;: &quot;queenbee#passwords&quot;, constraints: :&quot;TestRoutingMapper&quot;:&quot;IpRestrictor&quot;

  @scope &quot;pt&quot;, as: &quot;pt&quot;, -&gt;
    @resources &quot;projects&quot;, pathNames: { edit: &quot;editar&quot;, new: &quot;novo&quot; }, path: &quot;projetos&quot;, -&gt;
      @post &quot;preview&quot;, on: &quot;new&quot;
      @put &quot;close&quot;, on: &quot;member&quot;, path: &quot;fechar&quot;
      @get &quot;open&quot;, on: &quot;new&quot;, path: &quot;abrir&quot;
    @resource  &quot;admin&quot;, pathNames: { new: &quot;novo&quot;, activate: &quot;ativar&quot; }, path: &quot;administrador&quot;, -&gt;
      @post &quot;preview&quot;, on: &quot;new&quot;
      @put &quot;activate&quot;, on: &quot;member&quot;
    @resources &quot;products&quot;, pathNames: { new: &quot;novo&quot; }, -&gt;
      @new, -&gt;
        @post &quot;preview&quot;

  @resources &quot;projects&quot;, controller: &quot;project&quot;, -&gt;
    @resources &quot;involvements&quot;, &quot;attachments&quot;
    @get &quot;correlationIndexes&quot;, on: &quot;collection&quot;

    @resources &quot;participants&quot;, -&gt;
      @put &quot;updateAll&quot;, on: &quot;collection&quot;

    @resources &quot;companies&quot;, -&gt;
      @resources &quot;people&quot;
      @resource  &quot;avatar&quot;, controller: &quot;avatar&quot;

    @resources &quot;images&quot;, as: &quot;funnyImages&quot;, -&gt;
      @post &quot;revise&quot;, on: &quot;member&quot;

    @resource &quot;manager&quot;, as: &quot;superManager&quot;, -&gt;
      @post &quot;fire&quot;

    @resources &quot;people&quot;, -&gt;
      @nested, -&gt;
        @scope &quot;/&quot;accessToken&quot;&quot;, -&gt;
          @resource &quot;avatar&quot;

      @member, -&gt;
        @get  &quot;somePathWithName&quot;
        @put  &quot;accessibleProjects&quot;
        @post &quot;resend&quot;, &quot;generateNewPassword&quot;

    @resources &quot;posts&quot;, -&gt;
      @get  &quot;archive&quot;, &quot;toggleView&quot;, on: &quot;collection&quot;
      @post &quot;preview&quot;, on: &quot;member&quot;

      @resource &quot;subscription&quot;

      @resources &quot;comments&quot;, -&gt;
        @post &quot;preview&quot;, on: &quot;collection&quot;

  @resources &quot;replies&quot;, -&gt;
    @collection, -&gt;
      @get &quot;page/&quot;page&quot;&quot;: &quot;replies#index&quot;, page: %r{\d+}
      @get &quot;&quot;page&quot;&quot;: &quot;replies#index&quot;, page: %r{\d+}

    @new, -&gt;
      @post &quot;preview&quot;

    @member, -&gt;
      @put &quot;answer&quot;, to: &quot;markAsAnswer&quot;
      @delete &quot;answer&quot;, to: &quot;unmarkAsAnswer&quot;

  @resources &quot;posts&quot;, only: [&quot;index&quot;, &quot;show&quot;], -&gt;
    @namespace &quot;admin&quot;, -&gt;
      @root to: &quot;index#index&quot;
    @resources &quot;comments&quot;, except: &quot;destroy&quot;, -&gt;
      @get &quot;views&quot;: &quot;comments#views&quot;, as: &quot;views&quot;

  @resource  &quot;past&quot;, only: &quot;destroy&quot;
  @resource  &quot;present&quot;, only: &quot;update&quot;
  @resource  &quot;future&quot;, only: &quot;create&quot;
  @resources &quot;relationships&quot;, only: [&quot;create&quot;, &quot;destroy&quot;]
  @resources &quot;friendships&quot;,   only: [&quot;update&quot;]

  @shallow, -&gt;
    @namespace &quot;api&quot;, -&gt;
      @resources &quot;teams&quot;, -&gt;
        @resources &quot;players&quot;
        @resource &quot;captain&quot;

  @scope &quot;/hello&quot;, -&gt;
    @shallow, -&gt;
      @resources &quot;notes&quot;, -&gt;
        @resources &quot;trackbacks&quot;

  @resources &quot;threads&quot;, shallow: true, -&gt;
    @resource &quot;owner&quot;
    @resources &quot;messages&quot;, -&gt;
      @resources &quot;comments&quot;, -&gt;
        @member, -&gt;
          @post &quot;preview&quot;

  @resources &quot;sheep&quot;, -&gt;
    @get &quot;_it&quot;, on: &quot;member&quot;

  @resources &quot;clients&quot;, -&gt;
    @namespace &quot;google&quot;, -&gt;
      @resource &quot;account&quot;, -&gt;
        @namespace &quot;secret&quot;, -&gt;
          @resource &quot;info&quot;

  @resources &quot;customers&quot;, -&gt;
    @get &quot;recent&quot;, on: &quot;collection&quot;
    @get &quot;profile&quot;, on: &quot;member&quot;
    @get &quot;secret/profile&quot;: &quot;customers#secret&quot;, on: &quot;member&quot;
    @post &quot;preview&quot;: &quot;customers#preview&quot;, as: &quot;anotherPreview&quot;, on: &quot;new&quot;
    @resource &quot;avatar&quot;, -&gt;
      @get &quot;thumbnail&quot;: &quot;avatars#thumbnail&quot;, as: &quot;thumbnail&quot;, on: &quot;member&quot;
    @resources &quot;invoices&quot;, -&gt;
      @get &quot;outstanding&quot;: &quot;invoices#outstanding&quot;, on: &quot;collection&quot;
      @get &quot;overdue&quot;, to: &quot;overdue&quot;, on: &quot;collection&quot;
      @get &quot;print&quot;: &quot;invoices#print&quot;, as: &quot;print&quot;, on: &quot;member&quot;
      @post &quot;preview&quot;: &quot;invoices#preview&quot;, as: &quot;preview&quot;, on: &quot;new&quot;
      @get &quot;aged/&quot;months&quot;&quot;, on: &quot;collection&quot;, action: &quot;aged&quot;, as: &quot;aged&quot;
    @resources &quot;notes&quot;, shallow: true, -&gt;
      @get &quot;preview&quot;: &quot;notes#preview&quot;, as: &quot;preview&quot;, on: &quot;new&quot;
      @get &quot;print&quot;: &quot;notes#print&quot;, as: &quot;print&quot;, on: &quot;member&quot;
    @get &quot;inactive&quot;, on: &quot;collection&quot;
    @post &quot;deactivate&quot;, on: &quot;member&quot;
    @get &quot;old&quot;, on: &quot;collection&quot;, as: &quot;stale&quot;
    @get &quot;export&quot;

  @namespace &quot;api&quot;, -&gt;
    @resources &quot;customers&quot;, -&gt;
      @get &quot;recent&quot;: &quot;customers#recent&quot;, as: &quot;recent&quot;, on: &quot;collection&quot;
      @get &quot;profile&quot;: &quot;customers#profile&quot;, as: &quot;profile&quot;, on: &quot;member&quot;
      @post &quot;preview&quot;: &quot;customers#preview&quot;, as: &quot;preview&quot;, on: &quot;new&quot;
    @scope(&quot;&quot;version&quot;&quot;, version: /.+/), -&gt;
      @resources &quot;users&quot;, id: /.+?/, format: /json|xml/

  @match &quot;sprockets.js&quot;: :&quot;TestRoutingMapper&quot;:&quot;SprocketsApp&quot;

  @match &quot;people/&quot;id&quot;/update&quot;, to: &quot;people#update&quot;, as: &quot;updatePerson&quot;
  @match &quot;/projects/&quot;projectId&quot;/people/&quot;id&quot;/update&quot;, to: &quot;people#update&quot;, as: &quot;updateProjectPerson&quot;

  # misc
  @match &quot;articles/&quot;year&quot;/&quot;month&quot;/&quot;day&quot;/&quot;title&quot;&quot;, to: &quot;articles#show&quot;, as: &quot;article&quot;

  # default params
  @match &quot;inlinePages/(&quot;id&quot;)&quot;, to: &quot;pages#show&quot;, id: &quot;home&quot;
  @match &quot;defaultPages/(&quot;id&quot;)&quot;, to: &quot;pages#show&quot;, defaults: { id: &quot;home&quot; }
  @defaults id: &quot;home&quot;, -&gt;
    @match &quot;scopedPages/(&quot;id&quot;)&quot;, to: &quot;pages#show&quot;

  @namespace &quot;account&quot;, -&gt;
    @match &quot;shorthand&quot;
    @match &quot;description&quot;, to: &quot;description&quot;, as: &quot;description&quot;
    @match &quot;&quot;action&quot;/callback&quot;, action: /twitter|github/, to: &quot;callbacks&quot;, as: &quot;callback&quot;
    @resource &quot;subscription&quot;, &quot;credit&quot;, &quot;creditCard&quot;

    @root to: &quot;account#index&quot;

    @namespace &quot;admin&quot;, -&gt;
      @resource &quot;subscription&quot;

  @namespace &quot;forum&quot;, -&gt;
    @resources &quot;products&quot;, path: &quot;&quot;, -&gt;
      @resources &quot;questions&quot;

  @namespace &quot;users&quot;, path: &quot;usuarios&quot;, -&gt;
    @root to: &quot;home#index&quot;

  @controller &quot;articles&quot;, -&gt;
    @scope &quot;/articles&quot;, as: &quot;article&quot;, -&gt;
      @scope path: &quot;/&quot;title&quot;&quot;, title: /[a-z]+/, as: &quot;withTitle&quot;, -&gt;
        @match &quot;/&quot;id&quot;&quot;, to: &quot;withId&quot;, as: &quot;&quot;

  @scope &quot;&quot;accessToken&quot;&quot;, constraints: { accessToken: /\w{5,5}/ }, -&gt;
    @resources &quot;rooms&quot;

  @match &quot;/info&quot;: &quot;projects#info&quot;, as: &quot;info&quot;

  @namespace &quot;admin&quot;, -&gt;
    @scope &quot;(&quot;locale&quot;)&quot;, locale: /en|pl/, -&gt;
      @resources &quot;descriptions&quot;

  @scope &quot;(&quot;locale&quot;)&quot;, locale: /en|pl/, -&gt;
    @get &quot;registrations/new&quot;
    @resources &quot;descriptions&quot;
    @root to: &quot;projects#index&quot;

  @scope only: [&quot;index&quot;, &quot;show&quot;], -&gt;
    @resources &quot;products&quot;, constraints: { id: /\d{4}/ }, -&gt;
      @root to: &quot;products#root&quot;
      @get &quot;favorite&quot;, on: &quot;collection&quot;
      @resources &quot;images&quot;
    @resource &quot;account&quot;

  @resource &quot;dashboard&quot;, constraints: { ip: /192\.168\.1\.\d{1,3}/ }

  @resource &quot;token&quot;, module: &quot;api&quot;
  @scope module: &quot;api&quot;, -&gt;
    @resources &quot;errors&quot;, shallow: true, -&gt;
      @resources &quot;notices&quot;

  @scope path: &quot;api&quot;, -&gt;
    @resource &quot;me&quot;
    @match &quot;/&quot;: &quot;mes#index&quot;

  @get &quot;(/&quot;username&quot;)/followers&quot;: &quot;followers#index&quot;
  @get &quot;/groups(/user/&quot;username&quot;)&quot;: &quot;groups#index&quot;
  @get &quot;(/user/&quot;username&quot;)/photos&quot;: &quot;photos#index&quot;

  @scope &quot;(groups)&quot;, -&gt;
    @scope &quot;(discussions)&quot;, -&gt;
      @resources &quot;messages&quot;

  @match &quot;whatever/&quot;controller&quot;(/&quot;action&quot;(/&quot;id&quot;))&quot;, id: /\d+/

  @resource &quot;profile&quot;, -&gt;
    @get &quot;settings&quot;

    @new, -&gt;
      @post &quot;preview&quot;

  @resources &quot;content&quot;

  @namespace &quot;transport&quot;, -&gt;
    @resources &quot;taxis&quot;

  @namespace &quot;medical&quot;, -&gt;
    @resource &quot;taxis&quot;

  @scope constraints: { id: /\d+/ }, -&gt;
    @get &quot;/tickets&quot;, to: &quot;tickets#index&quot;, as: &quot;tickets&quot;

  @scope constraints: { id: /\d{4}/ }, -&gt;
    @resources &quot;movies&quot;, -&gt;
      @resources &quot;reviews&quot;
      @resource &quot;trailer&quot;

  @namespace &quot;private&quot;, -&gt;
    @root to: redirect(&quot;/private/index&quot;)
    @match &quot;index&quot;, to: &quot;private#index&quot;

  @scope only: [&quot;index&quot;, &quot;show&quot;], -&gt;
    @namespace &quot;only&quot;, -&gt;
      @resources &quot;clubs&quot;, -&gt;
        @resources &quot;players&quot;
        @resource  &quot;chairman&quot;

  @scope except: [&quot;new&quot;, &quot;create&quot;, &quot;edit&quot;, &quot;update&quot;, &quot;destroy&quot;], -&gt;
    @namespace &quot;except&quot;, -&gt;
      @resources &quot;clubs&quot;, -&gt;
        @resources &quot;players&quot;
        @resource  &quot;chairman&quot;

  @namespace &quot;wiki&quot;, -&gt;
    @resources &quot;articles&quot;, id: /[^\/]+/, -&gt;
      @resources &quot;comments&quot;, only: [&quot;create&quot;, &quot;new&quot;]

  @resources &quot;wikiPages&quot;, path: &quot;pages&quot;
  @resource &quot;wikiAccount&quot;, path: &quot;myAccount&quot;

  @scope only: &quot;show&quot;, -&gt;
    @namespace &quot;only&quot;, -&gt;
      @resources &quot;sectors&quot;, only: &quot;index&quot;, -&gt;
        @resources &quot;companies&quot;, -&gt;
          @scope only: &quot;index&quot;, -&gt;
            @resources &quot;divisions&quot;
          @scope except: [&quot;show&quot;, &quot;update&quot;, &quot;destroy&quot;], -&gt;
            @resources &quot;departments&quot;
        @resource  &quot;leader&quot;
        @resources &quot;managers&quot;, except: [&quot;show&quot;, &quot;update&quot;, &quot;destroy&quot;]

  @scope except: &quot;index&quot;, -&gt;
    @namespace &quot;except&quot;, -&gt;
      @resources &quot;sectors&quot;, except: [&quot;show&quot;, &quot;update&quot;, &quot;destroy&quot;], -&gt;
        @resources &quot;companies&quot;, -&gt;
          @scope except: [&quot;show&quot;, &quot;update&quot;, &quot;destroy&quot;], -&gt;
            @resources &quot;divisions&quot;
          @scope only: &quot;index&quot;, -&gt;
            @resources &quot;departments&quot;
        @resource  &quot;leader&quot;
        @resources &quot;managers&quot;, only: &quot;index&quot;

  @resources &quot;sections&quot;, id: /.+/, -&gt;
    @get &quot;preview&quot;, on: &quot;member&quot;

  @scope as: &quot;routes&quot;, -&gt;
    @get &quot;/c/&quot;id&quot;&quot;, as: &quot;collision&quot;, to: &quot;collision#show&quot;
    @get &quot;/collision&quot;, to: &quot;collision#show&quot;
    @get &quot;/noCollision&quot;, to: &quot;collision#show&quot;, as: nil

    @get &quot;/fc/&quot;id&quot;&quot;, as: &quot;forcedCollision&quot;, to: &quot;forcedCollision#show&quot;
    @get &quot;/forcedCollision&quot;, as: &quot;forcedCollision&quot;, to: &quot;forcedCollision#show&quot;

  @match &quot;/purchases/&quot;token&quot;/&quot;filename&quot;&quot;,
    to: &quot;purchases#fetch&quot;,
    token: /[[&quot;alnum&quot;:]]{10}/,
    filename: /(.+)/,
    as: &quot;purchase&quot;

  @resources &quot;lists&quot;, id: /([A-Za-z0-9]{25})|default/, -&gt;
    @resources &quot;todos&quot;, id: /\d+/

  @scope &quot;/countries/&quot;country&quot;&quot;, constraints: lambda { |params, req| params[&quot;country&quot;].in?([&quot;all&quot;, &quot;France&quot;]) }, -&gt;
    @match &quot;/&quot;,       to: &quot;countries#index&quot;
    @match &quot;/cities&quot;, to: &quot;countries#cities&quot;

  @match &quot;/countries/&quot;country&quot;/(*other)&quot;, to: redirect{ |params, req| params[&quot;other&quot;] ? &quot;/countries/all/#{params[&quot;other&quot;]}&quot; : &quot;/countries/all&quot; }

  @match &quot;/&quot;locale&quot;/*file.&quot;format&quot;&quot;, to: &quot;files#show&quot;, file: /path\/to\/existing\/file/

  @scope &quot;/italians&quot;, -&gt;
    @match &quot;/writers&quot;, to: &quot;italians#writers&quot;, constraints: :&quot;TestRoutingMapper&quot;:&quot;IpRestrictor&quot;
    @match &quot;/sculptors&quot;, to: &quot;italians#sculptors&quot;
    @match &quot;/painters/&quot;painter&quot;&quot;, to: &quot;italians#painters&quot;, constraints: {painter: /michelangelo/}
</code></pre>
</section>